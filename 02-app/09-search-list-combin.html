<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>组合式API用户列表</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        .container {
            margin: 50px;
        }

        .content {
            margin: 20px;
        }
    </style>
</head>
<body>
<div id="app">

</div>
<script>
    const {createApp, ref} = Vue;
    let mock = [
        {
            name: "小王",
            sex: 0
        }, {
            name: "小红",
            sex: 1
        }, {
            name: "小李",
            sex: 1
        }, {
            name: "小张",
            sex: 0
        }
    ]

    const config = {
        setup() {
            const showData = ref([]);
            const loadData = () => {
                setTimeout(() => {
                    showData.value = mock;
                }, 500);
            }
            Vue.onMounted(loadData);
            let sexFilter = ref(-1);
            let searchKey = ref('');

            let filterData = () => {
                searchKey.value = "";
                if (sexFilter.value === -1) {
                    showData.value = mock;
                } else {
                    showData.value = mock.filter((e) => {
                        return e.sex === sexFilter.value;
                    })
                }
            }

            let searchData = () => {
                sexFilter.value = -1;
                if (searchKey.value === "") {
                    showData.value = mock;
                } else {
                    showData.value = mock.filter((e) => {
                        return e.name.search(searchKey.value) !== -1;
                    })
                }
            }

            Vue.watch(sexFilter, filterData);
            Vue.watch(searchKey, searchData);

            return {showData, sexFilter, searchKey};
        },
        template: `
          <div class="container">
            <div class="content">
              <input type="radio" :value="-1" v-model="sexFilter"/>全部
              <input type="radio" :value="0" v-model="sexFilter"/>男
              <input type="radio" :value="1" v-model="sexFilter"/>女
            </div>
            <div class="content">搜索：<input type="text" v-model="searchKey"/></div>
            <div class="content">
              <table border="1" width="300px">
                <tr>
                  <th>姓名</th>
                  <th>性别</th>
                </tr>
                <tr v-for="(data, index) in showData">
                  <td>{{ data.name }}</td>
                  <td>{{ data.sex === 0 ? '男' : '女' }}</td>
                </tr>
              </table>
            </div>
          </div>
        `
    }
    createApp(config).mount('#app');
</script>
</body>
</html>